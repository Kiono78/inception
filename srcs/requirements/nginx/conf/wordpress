#https://www.nginx.com/resources/wiki/start/topics/recipes/wordpress/
##upstream php {
#        server unix:/tmp/php-cgi.socket;
#        server wordpress:9000;
#}
#
#server {
#		#https
#		listen 443 ssl;
#		listen [::]:443 ssl;
#		# Protocole d'encryptions pour les cles ssl
#		ssl_certificate		/etc/nginx/ssl/bterral.42.fr.crt;
#		ssl_certificate_key	/etc/nginx/ssl/bterral.42.fr.key;
#		ssl_protocols		TLSv1.2 TLSv1.3;
#        ## Your website name goes here.
#        server_name bterral.42.fr;
#        ## Your only path reference.
#        root /var/www/wordpress;
#        ## This should be in your http block and if it is, it's not needed here.
#        index index.php;
#
#        location = /favicon.ico {
#                log_not_found off;
#                access_log off;
#        }
#
#        location = /robots.txt {
#                allow all;
#                log_not_found off;
#                access_log off;
#        }
#
#        location / {
#                # This is cool because no php is touched for static content.
#                # include the "?$args" part so non-default permalinks doesn't break when using query string
#                try_files $uri $uri/ /index.php?$args;
#        }
#
#        location ~ \.php$ {
#                #NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini
#                include fastcgi_params;
#                fastcgi_intercept_errors on;
#                fastcgi_pass php;
#                #The following parameter can be also included in fastcgi_params file
#                fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
#        }
#
#        location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
#                expires max;
#                log_not_found off;
#        }
#}
#
# Minimum necessaire pour servir nos pages php wordpress
server {
	# Definition du nom de domaine comme demande dans le sujet
	server_name	bterral.42.fr;

	# Ecoute en ssl uniquement 
	listen 443 ssl;
	listen [::]:443 ssl;

	# On note le cert et la key (necessaire protocole ssl)
	ssl_certificate		/etc/nginx/ssl/bterral.42.fr.crt;
	ssl_certificate_key	/etc/nginx/ssl/bterral.42.fr.key;

	# Protocole d'encryptions pour les cles ssl
	ssl_protocols		TLSv1.2 TLSv1.3;

	# Fichiers a afficher et dossier ou les chercher
	root /var/www/wordpress;
	index index.php index.html;

	# Directive necessaire pour les endpoints, 
	# Fast cgi necessaire pour nginx pour "traduire" le php
	location / {
		location ~ \.php$ {
			fastcgi_split_path_info ^(.+\.php)(/.+)$;
			fastcgi_pass wordpress:9000;
			fastcgi_index index.php;
			include fastcgi_params;
			fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
			fastcgi_param SCRIPT_NAME $fastcgi_script_name;
		}
	}
}